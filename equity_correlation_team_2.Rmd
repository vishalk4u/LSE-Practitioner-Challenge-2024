---
title: "Equity Correlations"
author: 'TEAM 2'
date: "2024-02-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load the libraries

```{r}
library(tidyquant)
library(timetk)
library(tidyverse)
library(GGally)
```

```{r}
# Setting our stock symbols to a variable
tickers <- c("VALE", "PBR", "ITUB", "ABCB", "GIVSY", "EC")

# Dowload the stock price data

multpl_stocks <- tq_get(tickers,
                        from = "2013-01-01",
                        to = "2018-03-01",
                        get = "stock.prices")

multpl_stocks[is.na(multpl_stocks)]
```

```{r}
multpl_stocks %>%
  ggplot(aes(x = date, y = adjusted, color = symbol)) +
  geom_line() +
  ggtitle("Price chart for multiple stocks")
```

```{r}
#Calculating the monthly returns for multiple stocks
multpl_stock_monthly_returns <- multpl_stocks %>%
  group_by(symbol) %>%                             # We are grouping the stocks by symbol
  tq_transmute(select = adjusted,
               mutate_fun = periodReturn,
               period = 'monthly',
               col_rename = 'returns')

sum(is.na(multpl_stock_monthly_returns))
```

```{r}
multpl_stock_monthly_returns %>%
  ggplot(aes(x = date, y = returns)) +
  geom_bar(stat = "identity") +
  geom_hline(yintercept = 0) +
  facet_wrap(~symbol, scales = "free_y") +
  scale_y_continuous(labels = scales::percent,
                     breaks = seq(-0.5,0.75,0.05)) +
  ggtitle("Monthly returns for Latin American Companies stock") +
  labs(x = "Date", y = "Returns") +
  scale_fill_brewer(palette = "Set1",   # We will give them different colors instead of black
                     name = "",
                     guide = FALSE) +
  theme_classic()
```

```{r}
# Calculating the correlation
company_corr <- multpl_stock_monthly_returns %>%
  spread(symbol, value = returns) %>%
  tk_xts(silent = TRUE) %>%
  cor() 
```

```{r}
# Define company_info data frame
company_info <- data.frame(
  symbol = c("VALE", "PBR", "ITUB", "ABCB", "GIVSY", "EC"),
  Sector = c("Basic Materials", "Energy", "Bank", "Bank", "Insurance", "Energy"),
  Fsector = c("Non_Financial", "Non_Financial", "Financial", "Financial", "Financial", "Non_Financial"),
  Country = c("Brazil", "Brazil", "Brazil", "Brazil", "Colombia", "Colombia")
)
```

## Bruteforce Method: Combinations

Global corr (different countries and sector):

VALE (Brazil) vs GIVSY (Colombia)
PBR (Brazil) vs GIVSY (Colombia)
ITUB (Brazil) vs EC (Colombia)
ABCB (Brazil) vs EC (Colombia)

Countries corr (same countries and different sector):

VALE (Brazil) vs PBR (Brazil)
VALE (Brazil) vs ITUB (Brazil)
VALE (Brazil) vs ABCB (Brazil)
PBR (Brazil) vs ITUB (Brazil)
PBR (Brazil) vs ABCB (Brazil)
GIVSY (Colombia) vs EC (Colombia)

Financial sector corr (same countries)
ITUB (Brazil) vs ABCB (Brazil)

Non-Financial sector corr (same countries)
VALE (Brazil) vs PBR (Brazil)

Task 1: Global correlation coefficient
```{r}
correlation_VALE_GIVSY <- company_corr["VALE", "GIVSY"]
correlation_PBR_GIVSY <- company_corr["PBR", "GIVSY"]
correlation_ITUB_EC <- company_corr["ITUB", "EC"]
correlation_ABCB_EC <- company_corr["ABCB", "EC"]


avg_global_corr <- sum(correlation_VALE_GIVSY, correlation_PBR_GIVSY, 
                       correlation_ITUB_EC, correlation_ABCB_EC)/4

avg_global_corr
```

Task 2: Country Correlation coefficient
```{r}
correlation_VALE_PBR <- company_corr["VALE", "PBR"]
correlation_VALE_ITUB <- company_corr["VALE", "ITUB"]
correlation_VALE_ABCB <- company_corr["VALE", "ABCB"]
correlation_PBR_ITUB <- company_corr["PBR", "ITUB"]
correlation_PBR_ABCB <- company_corr["PBR", "ABCB"]
correlation_GIVSY_EC <- company_corr["GIVSY", "EC"]

avg_countries_corr <- sum(correlation_VALE_PBR, correlation_VALE_ITUB, 
                       correlation_VALE_ABCB, correlation_PBR_ITUB,
                       correlation_PBR_ABCB, correlation_GIVSY_EC)/6

avg_countries_corr
```

Task 3: Financial sector correlation coefficient
```{r}
correlation_ITUB_ABCB <- company_corr["ITUB", "ABCB"]

avg_countries_corr <- correlation_ITUB_ABCB

avg_countries_corr
```

Task 4: Non-Financial sector correlation coefficient
```{r}
correlation_VALE_PBR <- company_corr["VALE", "PBR"]

avg_countries_corr <- correlation_VALE_PBR

avg_countries_corr
```





